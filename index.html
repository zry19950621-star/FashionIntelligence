<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一周时尚资讯速报 - Weekly Fashion Brief</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', -apple-system, sans-serif; }
        .serif-title { font-family: 'Noto Serif SC', serif; }
        
        .selection-blue::selection { background-color: #dbeafe; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .annual-gradient { background: linear-gradient(135deg, #020617 0%, #1e293b 100%); }
        
        /* 杂志风格样式 */
        .magazine-dropcap::first-letter {
            float: left;
            font-size: 5rem;
            line-height: 4rem;
            padding-top: 0.5rem;
            padding-right: 0.8rem;
            font-weight: 900;
            color: #000;
            font-family: 'Noto Serif SC', serif;
        }

        .magazine-column {
            column-count: 1;
        }
        @media (min-width: 1024px) {
            .magazine-column { column-count: 2; column-gap: 3rem; }
        }

        .pull-quote {
            font-size: 1.5rem;
            font-weight: 700;
            font-style: italic;
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
            padding: 1.5rem 0;
            margin: 2rem 0;
            line-height: 1.4;
            color: #1a1a1a;
            font-family: 'Noto Serif SC', serif;
        }

        .illustration-container {
            margin: 2rem 0;
            background: #f0f0f0;
            border-radius: 4px;
            padding: 1rem;
            text-align: center;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-magazine { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="bg-[#F6F6F6] selection-blue">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- 配置区域 ---
        const DEEPSEEK_API_URL = "https://api.deepseek.com/chat/completions";
        const DEEPSEEK_MODEL = "deepseek-chat";
        // ----------------

        const Icon = ({ name, className = "w-4 h-4", strokeWidth = 2 }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = '';
                    const iconElt = document.createElement('i');
                    iconElt.setAttribute('data-lucide', name);
                    if (className) iconElt.setAttribute('class', className);
                    if (strokeWidth) iconElt.setAttribute('data-lucide-stroke-width', strokeWidth);
                    iconRef.current.appendChild(iconElt);
                    window.lucide.createIcons({
                        attrs: { class: className, 'stroke-width': strokeWidth },
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, className, strokeWidth]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"></span>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('this-week'); 
            const [isGenerating, setIsGenerating] = useState(false);
            const [weeklyReport, setWeeklyReport] = useState(null);
            const [showReport, setShowReport] = useState(false);
            const [apiKey, setApiKey] = useState(localStorage.getItem('deepseek_api_key') || "sk-3d7832ebaa0b4e599d6f58f0fb159814");
            const [error, setError] = useState(null);

            // 核心维度与信源定义
            const dimensions = {
                industry: { label: "产业 / 品牌动态", icon: "briefcase", color: "text-blue-600", bg: "bg-blue-50", 
                    links: [
                        { name: "BoF", url: "https://www.businessoffashion.com", desc: "全球时尚产业的“内部参考书”" },
                        { name: "Vogue Business", url: "https://www.voguebusiness.com", desc: "商业 + 文化交叉观察" },
                        { name: "WWD", url: "https://wwd.com", desc: "行业快讯与交易层信息源" }
                    ]
                },
                runway: { label: "秀场 / 系列", icon: "clapperboard", color: "text-purple-600", bg: "bg-purple-50", 
                    links: [
                        { name: "Vogue Runway", url: "https://www.vogue.com/runway", desc: "全球系统秀场档案库" },
                        { name: "SHOWstudio", url: "https://showstudio.com", desc: "影像 × 实验 × 身体表达" },
                        { name: "Dazed", url: "https://www.dazeddigital.com", desc: "青年文化与前沿审美" }
                    ]
                },
                culture: { label: "文化事件 / 展览", icon: "landmark", color: "text-amber-600", bg: "bg-amber-50", 
                    links: [
                        { name: "Met Museum", url: "https://www.metmuseum.org", desc: "时尚的历史化视角" },
                        { name: "V&A", url: "https://www.vam.ac.uk", desc: "设计史权威" },
                        { name: "Artforum", url: "https://www.artforum.com", desc: "当代艺术中的身体议题" }
                    ]
                },
                tech: { label: "科技 / AI / 材料", icon: "cpu", color: "text-emerald-600", bg: "bg-emerald-50", 
                    links: [
                        { name: "Wired", url: "https://www.wired.com", desc: "科技对身体的影响" },
                        { name: "Dezeen", url: "https://www.dezeen.com", desc: "设计 × 材料 × 技术" },
                        { name: "Fashion Tech News", url: "https://fashiontechnews.jp", desc: "垂直工具追踪" }
                    ]
                },
                social: { label: "社会议题", icon: "users", color: "text-rose-600", bg: "bg-rose-50", 
                    links: [
                        { name: "The Guardian", url: "https://www.theguardian.com/fashion", desc: "公共议题导向" },
                        { name: "NYT Style", url: "https://www.nytimes.com/section/style", desc: "主流政治讨论" },
                        { name: "i-D", url: "https://i-d.co", desc: "边缘与身份流动" }
                    ]
                }
            };

            const currentWeekIntel = [
                { id: 1, type: 'industry', source: 'BoF', title: '奢侈品巨头的防御性权力集中：LVMH 宣布重组区域管理权重', logic: '资本如何在波动期通过组织结构调整管理地缘政治风险。', url: 'https://www.businessoffashion.com' },
                { id: 2, type: 'runway', source: 'SHOWstudio', title: '2026 季：身体作为解构现场的再次降临', logic: '挑战传统模特规范，将 1990s 的实验性延续至虚拟身份探讨。', url: 'https://showstudio.com' },
                { id: 3, type: 'culture', source: 'V&A', title: '全球设计史回顾：时尚叙事中的历史回声', logic: '时尚如何被写入公共文化并产生持久的设计影响力。', url: 'https://www.vam.ac.uk' },
                { id: 4, type: 'tech', source: 'Wired', title: 'AI 模特与虚拟身份：技术如何模糊身体边界', logic: '数字孪生技术对时尚劳动力阶级的重塑。', url: 'https://www.wired.com' },
                { id: 5, type: 'social', source: 'i-D', title: '身份流动的未来：亚文化如何进入主流政治讨论', logic: '边缘身体如何成为当代时尚系统的核心叙事。', url: 'https://i-d.co' }
            ];

            const generateWeeklyBrief = async () => {
                if (!apiKey) {
                    setError("请先在设置中输入 DeepSeek API Key");
                    return;
                }

                setIsGenerating(true);
                setError(null);

                const systemPrompt = `你是一名享誉国际的时尚社会学家、产业分析师和文化策展人。
                请基于提供的五个维度资讯，生成一份名为《一周时尚报刊》的深度报告。
                要求：
                1. 学术语境：使用专业、辛辣且具有穿透力的语言。讨论资本关联、权力结构、身体政治和技术边界。
                2. 杂志排版指令：在文中适当位置插入 [PullQuote: 引用的金句] 和 [Illustration: 描述插图内容，例如：一副表现资本与身体关系的抽象线条图]。
                3. 五大维度深度结合：不要分开列举，要将产业、秀场、文化、科技与社会议题融汇贯通。
                4. 引用引用：在适当的观点后注明信源，例如 (Ref: BoF) 或 (Ref: Met Museum)。
                5. 字数约 1000 字，分为“卷首语”、“产业权力场”、“身体叙事”、“技术疆界”及“结语”。`;
                
                const userQuery = `本周核心动态：\n${currentWeekIntel.map(n => `[${n.source}] ${n.title}`).join('\n')}`;

                try {
                    const response = await fetch(DEEPSEEK_API_URL, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: DEEPSEEK_MODEL,
                            messages: [
                                { role: "system", content: systemPrompt },
                                { role: "user", content: userQuery }
                            ],
                            stream: false
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || `API 请求失败: ${response.status}`);
                    }

                    const result = await response.json();
                    const content = result.choices?.[0]?.message?.content;
                    
                    if (!content) {
                        throw new Error("API 返回内容为空");
                    }

                    setWeeklyReport(content);
                    setShowReport(true);
                } catch (err) {
                    console.error("生成失败", err);
                    setError(`生成失败: ${err.message}`);
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleApiKeyChange = (e) => {
                const val = e.target.value;
                setApiKey(val);
                localStorage.setItem('deepseek_api_key', val);
            };

            // 处理报刊文本中的插图和引言样式
            const renderMagazineContent = (text) => {
                if (!text) return null;
                const parts = text.split(/(\[PullQuote:.*?\]|\[Illustration:.*?\])/);
                return parts.map((part, index) => {
                    if (part.startsWith('[PullQuote:')) {
                        return <div key={index} className="pull-quote">{part.replace('[PullQuote:', '').replace(']', '')}</div>;
                    } else if (part.startsWith('[Illustration:')) {
                        const desc = part.replace('[Illustration:', '').replace(']', '');
                        return (
                            <div key={index} className="illustration-container">
                                <div className="w-full h-64 bg-slate-100 flex items-center justify-center border border-slate-200 mb-2">
                                    <span className="text-slate-400 font-bold italic"></span>
                                </div>
                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest italic">Fig {index}. AI Generated Illustration: {desc}</p>
                            </div>
                        );
                    } else {
                        return <p key={index} className="mb-6 leading-relaxed text-justify whitespace-pre-wrap">{part}</p>;
                    }
                });
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-100 sticky top-0 z-50 px-8 py-4">
                        <div className="max-w-[1400px] mx-auto flex justify-between items-center">
                            <div className="flex items-center space-x-4 cursor-pointer" onClick={() => setActiveTab('this-week')}>
                                <div className="bg-black text-white p-2 rounded-xl"><Icon name="layers" className="w-6 h-6" /></div>
                                <div>
                                    <h1 className="text-xl font-black tracking-tighter serif-title uppercase">一周时尚资讯速报</h1>
                                    <p className="text-[10px] text-slate-400 font-bold tracking-[0.2em] uppercase">Weekly Fashion Brief</p>
                                </div>
                            </div>
                            
                            <nav className="flex space-x-10 items-center">
                                <button onClick={() => { setActiveTab('this-week'); setShowReport(false); }} className={`text-sm font-black transition-all tracking-widest ${activeTab === 'this-week' && !showReport ? 'text-black border-b-2 border-black pb-1' : 'text-slate-300 hover:text-black'}`}>本周看板</button>
                                <div className="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100">
                                    <Icon name="key" className="w-3 h-3 text-slate-400" />
                                    <input 
                                        type="password" 
                                        placeholder="DeepSeek API Key" 
                                        value={apiKey}
                                        onChange={handleApiKeyChange}
                                        className="bg-transparent text-[10px] outline-none w-32 font-mono"
                                    />
                                </div>
                            </nav>

                            <button onClick={generateWeeklyBrief} disabled={isGenerating} className="bg-black text-white px-8 py-2.5 rounded-full text-xs font-black uppercase tracking-widest flex items-center gap-3 hover:bg-slate-800 transition-all disabled:opacity-50">
                                {isGenerating ? <Icon name="loader-2" className="animate-spin" /> : <Icon name="sparkles" />} 
                                生成本周报刊
                            </button>
                        </div>
                    </header>

                    {error && (
                        <div className="bg-red-50 border-b border-red-100 px-8 py-3 text-red-600 text-xs font-bold flex items-center justify-center gap-2">
                            <Icon name="alert-circle" className="w-4 h-4" />
                            {error}
                            <button onClick={() => setError(null)} className="ml-4 underline">关闭</button>
                        </div>
                    )}

                    <main className="flex-1 max-w-[1400px] mx-auto w-full px-8 py-10">
                        {activeTab === 'this-week' ? (
                            <div className="grid grid-cols-12 gap-10 h-full text-left">
                                {/* 左侧：五个维度的分类看板 */}
                                <div className={`${showReport ? 'col-span-4' : 'col-span-8'} transition-all duration-700 space-y-12 overflow-y-auto no-scrollbar pb-20`}>
                                    <div className="flex flex-col gap-2 mb-10">
                                        <h2 className="text-6xl font-black tracking-tighter serif-title uppercase">2026 W02</h2>
                                        <p className="text-slate-400 font-bold uppercase tracking-widest text-sm italic">Observation Framework for Understanding Contemporary Fashion</p>
                                    </div>

                                    {Object.entries(dimensions).map(([key, dim]) => (
                                        <section key={key} className="space-y-6">
                                            <div className="flex items-center justify-between border-b border-slate-200 pb-3">
                                                <div className="flex items-center gap-3">
                                                    <div className={`${dim.bg} ${dim.color} p-2 rounded-lg`}><Icon name={dim.icon} className="w-5 h-5" /></div>
                                                    <h3 className="font-black text-lg serif-title">{dim.label}</h3>
                                                </div>
                                            </div>
                                            
                                            <div className="grid gap-6">
                                                {currentWeekIntel.filter(item => item.type === key).map(item => (
                                                    <div key={item.id} className="group bg-white p-6 rounded-[24px] border border-slate-100 shadow-sm hover:border-black transition-all duration-500 cursor-pointer">
                                                        <div className="flex justify-between items-start mb-4">
                                                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{item.source}</span>
                                                            <a href={item.url} target="_blank" className="text-[10px] font-bold text-blue-600 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-all">READ MORE <Icon name="external-link" className="w-3 h-3" /></a>
                                                        </div>
                                                        <h4 className="font-bold text-xl mb-3 leading-snug">{item.title}</h4>
                                                        <p className="text-sm text-slate-500 bg-slate-50 p-4 rounded-xl border-l-4 border-slate-200 font-medium italic leading-relaxed">{item.logic}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </section>
                                    ))}
                                </div>

                                {/* 右侧：监测面板或报刊视图 */}
                                <div className={`${showReport ? 'col-span-8' : 'col-span-4'} transition-all duration-700 h-full`}>
                                    {showReport ? (
                                        <div className="bg-white h-[calc(100vh-180px)] rounded-[50px] border border-slate-100 shadow-2xl overflow-hidden flex flex-col animate-magazine text-left">
                                            <div className="bg-black text-white p-12 relative overflow-hidden">
                                                <div className="relative z-10 flex justify-between items-end">
                                                    <div>
                                                        <div className="flex items-center gap-4 mb-8">
                                                            <span className="bg-white/10 px-3 py-1 rounded text-[9px] font-black uppercase tracking-[0.4em] border border-white/20">Decision Intelligence</span>
                                                            <span className="text-white/40 font-mono text-[9px] uppercase tracking-widest">Global Dispatch // 2026.01.09</span>
                                                        </div>
                                                        <h2 className="text-6xl font-black serif-title leading-[1.1] mb-2">一周时尚报刊</h2>
                                                        <p className="text-lg font-medium italic text-white/60 font-serif">Deep Analysis of Industry Logic & Cultural Shift</p>
                                                    </div>
                                                    <button onClick={() => setShowReport(false)} className="bg-white text-black p-4 rounded-full shadow-2xl hover:bg-slate-200 transition-colors"><Icon name="x" className="w-6 h-6" /></button>
                                                </div>
                                                <div className="absolute top-0 right-0 w-80 h-80 bg-blue-600/30 blur-[120px] -mr-40 -mt-40"></div>
                                            </div>
                                            <div className="flex-1 overflow-y-auto px-16 py-16 no-scrollbar text-left">
                                                <div className="magazine-column font-serif">
                                                    {renderMagazineContent(weeklyReport)}
                                                </div>
                                                <div className="mt-20 pt-10 border-t border-slate-100 flex justify-between items-center opacity-30">
                                                    <span className="text-[10px] font-black uppercase tracking-[0.5em]">End of Briefing</span>
                                                    <span className="text-[10px] font-black uppercase tracking-[0.5em]">Academic Integrity // Fashion Intelligence</span>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-6 animate-fade-in text-left">
                                            {/* 动态监测看板 */}
                                            <div className="bg-white p-10 rounded-[40px] border border-slate-100 shadow-sm relative overflow-hidden">
                                                <div className="flex items-center justify-between mb-8">
                                                    <h3 className="text-sm font-black flex items-center gap-2 opacity-50 uppercase tracking-[0.2em]"><Icon name="activity" /> 系统监测</h3>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                                        <span className="text-[9px] font-black text-green-600 uppercase">Live Tracking</span>
                                                    </div>
                                                </div>
                                                <div className="space-y-6">
                                                    {Object.entries(dimensions).map(([key, dim]) => {
                                                        const count = currentWeekIntel.filter(i => i.type === key).length;
                                                        const percentage = Math.min((count / 3) * 100, 100); 
                                                        return (
                                                            <div key={key} className="space-y-2">
                                                                <div className="flex justify-between text-[10px] font-black uppercase tracking-widest">
                                                                    <span className="text-slate-400">{dim.label}</span>
                                                                    <span className={count > 0 ? "text-black" : "text-slate-300"}>{count > 0 ? `${count} CAPTURED` : 'SCANNING'}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-50 h-2 rounded-full overflow-hidden">
                                                                    <div 
                                                                        className={`h-full transition-all duration-1000 ease-out ${count > 0 ? 'bg-black' : 'bg-slate-100'}`} 
                                                                        style={{ width: `${percentage}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            
                                            <div className="annual-gradient p-10 rounded-[40px] text-white shadow-xl flex flex-col items-center justify-center text-center gap-8 group cursor-pointer hover:scale-[1.02] transition-all" onClick={generateWeeklyBrief}>
                                                <div className="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center border border-white/20 group-hover:bg-white/20 transition-all">
                                                    <Icon name="sparkles" className="w-10 h-10" />
                                                </div>
                                                <div>
                                                    <h3 className="text-2xl font-black serif-title mb-2">生成深度报刊</h3>
                                                    <p className="text-white/50 text-xs font-bold uppercase tracking-widest">Generate Weekly Academic Briefing</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ) : (
                            <div className="flex items-center justify-center h-64 text-slate-400 font-bold uppercase tracking-widest">
                                Archive is empty
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
