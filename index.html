<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FashionIntelligence - 产业情报决策系统</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap' );
        body { font-family: 'Inter', sans-serif; }
        .selection-blue::selection { background-color: #dbeafe; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .annual-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-[#F8FAFC] selection-blue">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ==========================================
        // 配置 DeepSeek API
        // ==========================================
        const DEEPSEEK_API_KEY = ""; // <--- 请在此处填入您的 DeepSeek API Key
        const DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions";
        const DEEPSEEK_MODEL = "deepseek-chat";

        /**
         * 工具函数：获取 ISO 周数
         */
        const getISOWeek = (d ) => {
            const date = new Date(d.getTime());
            date.setHours(0, 0, 0, 0);
            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
            const week1 = new Date(date.getFullYear(), 0, 4);
            return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
        };

        const Icon = ({ name, className = "w-4 h-4", strokeWidth = 2 }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = '';
                    const iconElt = document.createElement('i');
                    iconElt.setAttribute('data-lucide', name);
                    if (className) iconElt.setAttribute('class', className);
                    if (strokeWidth) iconElt.setAttribute('data-lucide-stroke-width', strokeWidth);
                    iconRef.current.appendChild(iconElt);
                    window.lucide.createIcons({
                        attrs: { class: className, 'stroke-width': strokeWidth },
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, className, strokeWidth]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"></span>;
        };

        const App = () => {
            const [currentTime, setCurrentTime] = useState(new Date());
            const [activeTab, setActiveTab] = useState('this-week'); 
            const [isGenerating, setIsGenerating] = useState(false);
            const [error, setError] = useState(null);
            const [copyFeedback, setCopyFeedback] = useState(null);
            const [weeklyReport, setWeeklyReport] = useState(null);
            const [showReport, setShowReport] = useState(false);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 60000);
                return () => clearInterval(timer);
            }, []);

            const currentYear = currentTime.getFullYear();
            const currentWeek = useMemo(() => getISOWeek(currentTime), [currentTime]);

            const currentWeekIntel = [
                { id: 201, date: '01.09', source: 'BoF', category: '资本运作', title: '开云集团 (Kering) 宣布减持旗下某设计师品牌，转而增持自动化供应链技术公司。', url: 'https://www.businessoffashion.com/news/luxury/kering-automation-investment' },
                { id: 202, date: '01.08', source: 'Vogue Business', category: '合规逻辑', title: '欧盟针对纺织品进口颁布更严苛的数字标签法案 。', url: 'https://www.voguebusiness.com/sustainability/eu-digital-product-passports' },
                { id: 203, date: '01.07', source: 'WWD', category: '权力更迭', title: '前 Celine 功勋高管宣布加入某中国高端运动品牌担任全球首席战略官 。', url: 'https://wwd.com/business/executive-moves' },
                { id: 204, date: '01.06', source: 'BoF', category: '供应链', title: '全球皮料供应商实施‘配额制’供货逻辑 。', url: 'https://www.businessoffashion.com/articles/luxury/leather-supply-chain' }
            ];

            const pastWeeksArchive = [
                {
                    weekId: `${currentYear}-W${String(currentWeek - 1 ).padStart(2, '0')}`,
                    period: '上一周回顾',
                    theme: '跨年交替期的资本整合趋势复盘',
                    intelCount: 8,
                    summary: '在上一个周期内，核心品牌通过收缩非核心业务完成了现金流的回笼，为本周的并购动作埋下伏笔。',
                    sources: [
                        { name: 'BoF', title: 'End of Year Strategy Review', url: 'https://www.businessoffashion.com' }
                    ]
                }
            ];

            const annualReview2025 = {
                title: "2025 年度产业决策白皮书",
                summary: "2025 年是奢侈品行业从‘全域扩张’向‘存量防御’转型的关键一年 。资本流动更加审慎，权力结构向总部高度集中。",
                metrics: [
                    { label: "资本流转总量", value: "$14.2B", change: "-12%" },
                    { label: "权力更迭频率", value: "142起", change: "+15%" },
                    { label: "逻辑转型指数", value: "88.5", change: "合规驱动" }
                ],
                deepInsights: [
                    { category: "资本与并购", content: "私募股权开始大规模介入中等规模品牌的资产剥离与重组。" },
                    { category: "组织与权力", content: "创意总监的任期进一步缩短，首席执行官(CEO)的权力范围向创意领域渗透。" },
                    { category: "商业逻辑", content: "‘供应链主权’驱动的硬核奢侈逻辑正在取代传统审美营销。" }
                ]
            };

            const copyToClipboard = (text) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopyFeedback("链接已复制");
                    setTimeout(() => setCopyFeedback(null), 2000);
                } catch (err) {
                    setError({ title: "复制失败", message: "请手动复制。" });
                }
                document.body.removeChild(textArea);
            };

            const openLink = (url) => {
                if (!url) return;
                window.open(url, '_blank', 'noopener,noreferrer');
            };

            const generateWeeklyReview = async () => {
                if (!DEEPSEEK_API_KEY) {
                    setError({ title: "配置缺失", message: "请在代码第36行填入您的 DeepSeek API Key。" });
                    return;
                }
                setIsGenerating(true);
                setError(null);
                
                const systemPrompt = `你是一名顶级时尚产业分析师。请为 ${currentYear} 年第 ${currentWeek} 周生成一份研判决策内参。字数不少于800字。请使用专业、深刻的语气，分析本周情报背后的产业逻辑。`;
                const userQuery = `本周最新情报：\n${currentWeekIntel.map(n => `[${n.source}] ${n.title}`).join("\n")}`;

                try {
                    const response = await fetch(DEEPSEEK_API_URL, {
                        method: "POST",
                        headers: { 
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: DEEPSEEK_MODEL,
                            messages: [
                                { role: "system", content: systemPrompt },
                                { role: "user", content: userQuery }
                            ],
                            temperature: 0.7,
                            max_tokens: 2000
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTP 错误: ${response.status}`);
                    }

                    const result = await response.json();
                    const text = result.choices?.[0]?.message?.content;
                    
                    if (!text) throw new Error("DeepSeek 未返回有效内容，请检查 API 状态。");
                    
                    setWeeklyReport(text);
                    setShowReport(true);
                    setActiveTab("this-week");
                } catch (err) {
                    console.error("API Error:", err);
                    setError({ title: "生成失败", message: err.message || "API 调用异常，请检查网络或 API Key。" });
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {copyFeedback && (
                        <div className="fixed top-24 left-1/2 -translate-x-1/2 z-[100] bg-black text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-2 animate-bounce text-xs font-bold">
                            <Icon name="check-circle-2" className="text-green-400 w-4 h-4" /> {copyFeedback}
                        </div>
                    )}

                    <header className="bg-white border-b border-slate-200 sticky top-0 z-50 px-6 py-4 text-left">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center space-x-2 cursor-pointer" onClick={() => { setActiveTab('this-week'); setShowReport(false); }}>
                                <div className="bg-black text-white p-2 rounded-lg"><Icon name="shield-check" className="w-6 h-6" /></div>
                                <div>
                                    <h1 className="text-xl font-extrabold tracking-tight">FashionIntelligence</h1>
                                    <p className="text-[10px] text-blue-600 uppercase tracking-widest font-black text-left">Weekly Decision Inner Circle</p>
                                </div>
                            </div>
                            <div className="hidden md:flex items-center space-x-10">
                                <div className="flex flex-col items-end mr-4">
                                    <span className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">System Live Time</span>
                                    <span className="text-xs font-mono font-bold text-slate-800">{currentTime.toLocaleDateString()} {currentTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                </div>
                                <nav className="flex space-x-8">
                                    <button onClick={() => { setActiveTab('this-week'); setShowReport(false); }} className={`text-sm font-bold transition-all ${activeTab === 'this-week' && !showReport ? 'text-black border-b-2 border-black pb-1' : 'text-slate-400 hover:text-black'}`}>本周看板</button>
                                    <button onClick={() => { setActiveTab('past-weeks'); setShowReport(false); }} className={`text-sm font-bold transition-all ${activeTab === 'past-weeks' ? 'text-black border-b-2 border-black pb-1' : 'text-slate-400 hover:text-black'}`}>历周归档</button>
                                </nav>
                                <button onClick={generateWeeklyReview} disabled={isGenerating} className="bg-black text-white px-6 py-2 rounded-full text-xs font-bold flex items-center gap-2 transition-all hover:bg-slate-800 disabled:bg-slate-300">
                                    {isGenerating ? <Icon name="loader-2" className="animate-spin w-4 h-4" /> : <Icon name="sparkles" className="w-4 h-4" />} 
                                    {weeklyReport ? "更新深度研判" : "生成本周报刊"}
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-7xl mx-auto w-full px-6 py-8 overflow-hidden">
                        {error && (
                            <div className="mb-6 bg-red-50 border border-red-100 rounded-2xl p-4 flex items-center justify-between animate-in fade-in">
                                <div className="flex items-center gap-3"><Icon name="alert-circle" className="text-red-500 w-5 h-5" /><p className="text-sm font-bold text-red-900">{error.message}</p></div>
                                <button onClick={() => setError(null)} className="text-red-400"><Icon name="x" className="w-4 h-4" /></button>
                            </div>
                        )}

                        {activeTab === 'this-week' ? (
                            <div className="grid grid-cols-12 gap-8 h-full">
                                <div className={`${showReport ? 'col-span-5' : 'col-span-8'} transition-all duration-500 space-y-6 overflow-y-auto no-scrollbar pb-10 text-left`}>
                                    <div className="flex items-baseline gap-3 mb-6 fade-in-up">
                                        <h2 className="text-2xl font-black">{currentYear} 第 {currentWeek} 周</h2>
                                        <span className="text-slate-400 text-sm font-medium">实时捕获中</span>
                                    </div>
                                    <div className="relative border-l-2 border-slate-200 ml-3 space-y-8 pl-8">
                                        {currentWeekIntel.map((item) => (
                                            <div key={item.id} className="relative group">
                                                <div className="absolute -left-[41px] top-1 w-4 h-4 rounded-full bg-white border-4 border-black group-hover:scale-110 transition-transform"></div>
                                                <div className="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <span className="text-[9px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded font-bold uppercase tracking-widest">{item.source}</span>
                                                        <span className="text-[10px] font-mono text-slate-400">{item.date}</span>
                                                    </div>
                                                    <h3 className={`font-bold mb-4 leading-snug group-hover:text-blue-700 transition-colors ${showReport ? 'text-sm' : 'text-lg'}`}>{item.title}</h3>
                                                    <div className="flex justify-end gap-3">
                                                        <button onClick={() => copyToClipboard(item.url)} className="text-slate-300 hover:text-black transition-colors"><Icon name="copy" className="w-3.5 h-3.5" /></button>
                                                        <button onClick={() => openLink(item.url)} className="text-[10px] font-bold text-slate-900 hover:underline flex items-center gap-1">查阅原文 <Icon name="external-link" className="w-3 h-3" /></button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className={`${showReport ? 'col-span-7' : 'col-span-4'} transition-all duration-500 h-full`}>
                                    {showReport ? (
                                        <div className="bg-white h-[calc(100vh-160px)] rounded-[32px] border border-slate-200 shadow-xl overflow-hidden flex flex-col animate-in slide-in-from-right-10 text-left">
                                            <div className="bg-slate-900 text-white p-6 flex justify-between items-center">
                                                <div className="flex items-center gap-3">
                                                    <div className="bg-blue-600 p-2 rounded-lg"><Icon name="book-open" className="w-4 h-4" /></div>
                                                    <div>
                                                        <h3 className="font-bold text-sm">本周期刊研判</h3>
                                                        <p className="text-[10px] text-slate-400 font-mono text-left tracking-wider">{currentYear}-W{String(currentWeek).padStart(2, '0')} / INTERNAL INSIGHT</p>
                                                    </div>
                                                </div>
                                                <button onClick={() => setShowReport(false)} className="text-slate-400 hover:text-white p-2">
                                                    <Icon name="chevron-right" className="w-5 h-5" />
                                                </button>
                                            </div>
                                            <div className="flex-1 overflow-y-auto p-8 prose prose-slate max-w-none no-scrollbar">
                                                <div className="whitespace-pre-wrap leading-relaxed text-slate-700 text-base text-left">
                                                    {weeklyReport}
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-6 animate-in fade-in text-left">
                                            <div className="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">
                                                <h3 className="text-sm font-bold mb-6 flex items-center gap-2 text-slate-400 uppercase tracking-tighter"><Icon name="pie-chart" className="text-blue-600 w-4 h-4" /> 实时权重监控</h3>
                                                <div className="space-y-6">
                                                    <div><div className="flex justify-between text-[10px] font-black text-slate-400 mb-2 uppercase"><span>资本流向敏感度</span><span>85%</span></div><div className="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden"><div className="bg-blue-600 h-full w-[85%]"></div></div></div>
                                                    <div><div className="flex justify-between text-[10px] font-black text-slate-400 mb-2 uppercase"><span>权力重组频率</span><span>42%</span></div><div className="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden"><div className="bg-slate-900 h-full w-[42%]"></div></div></div>
                                                </div>
                                            </div>
                                            <div className="bg-blue-600 text-white p-8 rounded-3xl shadow-lg relative overflow-hidden group">
                                                <Icon name="sparkles" className="absolute -right-4 -top-4 w-24 h-24 opacity-10 group-hover:rotate-12 transition-transform" />
                                                <h3 className="font-bold mb-4">生成本周报刊</h3>
                                                <p className="text-xs text-blue-100 mb-6 leading-relaxed">系统已检测到 {currentYear} 第 {currentWeek} 周的 {currentWeekIntel.length} 条高价值数据。点击按钮启动逻辑串联。</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-12 animate-in fade-in text-left pb-20 overflow-y-auto h-[calc(100vh-160px)] no-scrollbar">
                                <section className="annual-gradient p-10 rounded-[40px] text-white shadow-2xl relative overflow-hidden">
                                    <div className="relative z-10">
                                        <div className="flex justify-between items-start mb-10">
                                            <div>
                                                <span className="bg-blue-600 text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-widest mb-4 inline-block">归档回顾: 2025 年度</span>
                                                <h2 className="text-4xl font-black mb-4">{annualReview2025.title}</h2>
                                                <p className="text-slate-300 max-w-2xl leading-relaxed">{annualReview2025.summary}</p>
                                            </div>
                                            <Icon name="award" className="w-16 h-16 text-blue-500 opacity-50" strokeWidth={1} />
                                        </div>
                                        
                                        <div className="grid md:grid-cols-3 gap-8 mb-10">
                                            {annualReview2025.metrics.map((m, i) => (
                                                <div key={i} className="bg-white/5 border border-white/10 p-6 rounded-3xl backdrop-blur-sm">
                                                    <p className="text-slate-400 text-xs font-bold uppercase mb-2 tracking-widest">{m.label}</p>
                                                    <div className="flex items-baseline gap-3">
                                                        <span className="text-3xl font-black">{m.value}</span>
                                                        <span className={`text-xs font-bold ${m.change.startsWith('+') ? 'text-green-400' : m.change.includes('$') ? 'text-blue-400' : 'text-red-400'}`}>{m.change}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="space-y-4">
                                            <h4 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 tracking-tighter">年度产业逻辑演变复盘</h4>
                                            <div className="grid md:grid-cols-3 gap-6">
                                                {annualReview2025.deepInsights.map((insight, i) => (
                                                    <div key={i} className="bg-white/5 p-5 rounded-2xl border border-white/5">
                                                        <div className="flex items-center gap-2 mb-3">
                                                            <div className="w-1 h-4 bg-blue-500 rounded-full"></div>
                                                            <span className="text-xs font-bold text-blue-400">{insight.category}</span>
                                                        </div>
                                                        <p className="text-sm text-slate-300 leading-relaxed">{insight.content}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <Icon name="globe" className="absolute -right-20 -bottom-20 w-80 h-80 text-white/5" />
                                </section>

                                <div className="flex justify-between items-end"><h2 className="text-2xl font-black">历周决策档案</h2><Icon name="archive" className="text-slate-200 w-10 h-10" /></div>
                                
                                <div className="grid gap-8">
                                    {pastWeeksArchive.map(week => (
                                        <div key={week.weekId} className="bg-white p-8 rounded-[32px] border border-slate-200 hover:border-black transition-all group">
                                            <div className="flex flex-col md:flex-row md:items-start justify-between gap-6 mb-8 text-left">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-3 mb-3">
                                                        <span className="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded uppercase">{week.weekId}</span>
                                                        <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{week.period}</span>
                                                    </div>
                                                    <h4 className="text-xl font-bold mb-2 group-hover:text-blue-600 transition-colors">{week.theme}</h4>
                                                    <p className="text-sm text-slate-500 leading-relaxed max-w-2xl">{week.summary}</p>
                                                </div>
                                                <div className="flex items-center gap-6 border-l border-slate-100 pl-8">
                                                    <div className="text-center">
                                                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-1">情报量</p>
                                                        <p className="text-xl font-black">{week.intelCount}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="pt-6 border-t border-slate-100 text-left">
                                                <h5 className="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest flex items-center gap-1">
                                                    <Icon name="link-2" className="w-3 h-3" /> 原始数据与原文追溯
                                                </h5>
                                                <div className="grid md:grid-cols-2 gap-3">
                                                    {week.sources.map((s, i) => (
                                                        <div key={i} className="flex items-center justify-between p-3 rounded-xl bg-slate-50 group/item hover:bg-slate-100 transition-all">
                                                            <div className="flex items-center gap-3 overflow-hidden">
                                                                <span className="text-[9px] font-black bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-400 uppercase">{s.name}</span>
                                                                <span className="text-xs text-slate-600 truncate font-medium">{s.title}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2 opacity-0 group-hover/item:opacity-100 transition-opacity">
                                                                <button onClick={() => copyToClipboard(s.url)} className="p-1 text-slate-400 hover:text-black transition-colors" title="复制链接"><Icon name="copy" className="w-3 h-3" /></button>
                                                                <button onClick={() => openLink(s.url)} className="p-1 text-slate-400 hover:text-blue-600 transition-colors" title="阅读原文"><Icon name="external-link" className="w-3 h-3" /></button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 px-6 py-4 flex justify-around items-center z-50">
                        <button onClick={() => { setActiveTab('this-week'); setShowReport(false); }} className={`flex flex-col items-center gap-1 ${activeTab === 'this-week' ? 'text-blue-600' : 'text-slate-400'}`}><Icon name="layout-dashboard" className="w-5 h-5" /><span className="text-[10px] font-bold">看板</span></button>
                        <button onClick={() => { setActiveTab('past-weeks'); setShowReport(false); }} className={`flex flex-col items-center gap-1 ${activeTab === 'past-weeks' ? 'text-blue-600' : 'text-slate-400'}`}><Icon name="history" className="w-5 h-5" /><span className="text-[10px] font-bold">档案</span></button>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
